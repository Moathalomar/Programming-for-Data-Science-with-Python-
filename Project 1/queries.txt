Q1

select c.name as name, count(title) as rental_countt
from film f 
join film_category f_c 
on f.film_id = f_c.film_id 
join category c 
on f_c.category_id = c.category_id 
join inventory i 
on f.film_id = i.film_id 
join rental r
on i.inventory_id = r.inventory_id 
where c.name in  ('Comedy', 'Family', 'Music', 'Animation', 'Children', 'Classics')
group by 1  
order by 1 ;


Q2

select f.title, c.name, f.rental_duration, NTILE(4) OVER (order by f.rental_duration) as standard_quartil
from film_category f_c
join category c
on c.category_id = f_c.category_id
join film f
on f.film_id = f_c.film_id
where c.name in ('Comedy', 'Family', 'Music', 'Animation', 'Children', 'Classics')
order by 4


Q3

select M1.name, M1.standard_quartile, count(M1.standard_quartile)
from (select f.title, c.name , f.rental_duration, NTILE(4) OVER (ORDER BY f.rental_duration) AS standard_quartile
from film_category f_c
join category c
on c.category_id = f_c.category_id
join film f
on f.film_id = f_c.film_id
where c.name in ('Comedy', 'Family', 'Music', 'Animation', 'Children', 'Classics'))  M1            
group by 1, 2
order by 1, 2


Q4

with M1 as (select p.customer_id, c.first_name    || ' ' ||  c.last_name as full_name, sum(amount) pay_total
from payment p
join customer c
on p.customer_id = c.customer_id
group by 1, 2
order by 3 desc
 limit 10)
select DATE_TRUNC('month', p.payment_date) PAy_month, M1.full_name, count(*) Pay_countperMon, sum(p.amount) Pay_amount
from M1
join payment p
on M1.customer_id = p.customer_id
group by 1, 2
order by 2, 1;

